import{_ as R}from"./AZe4v4NG.js";import{_ as x}from"./CsCcpkbL.js";import{b as C,_ as E}from"./a5gIThvW.js";import{c as h,b as T,d as U}from"./Cg1U94MN.js";import{q as u,D as Y,s as H,Y as k,E as g,c as p,b as _,a as b,F as q,A as z,d as B,z as D,o as f}from"./Dp92OCez.js";import{u as F}from"./VXoBHAh5.js";import{M as v}from"./DshPJGOp.js";import{u as A}from"./Ysp5PC-k.js";import{q as O}from"./C9y-xpOa.js";import"./B5ydHyOM.js";import"./D5YaZf7t.js";import"./BRiBHvXC.js";import"./CAZilBRX.js";import"./DvDH6DOc.js";import"./Cvga2AW9.js";async function V(r){if(!r.url)return{};const t=await $fetch(r.url,{method:"POST",body:{pageNo:r.pageNo,pageSize:r.pageSize||9,sort:r.sort||{createTime:-1,title:1}}});return t.data=t.data.map(s=>h(s)),t}const $={class:"container"},I={class:"articles"},G={key:0,href:"#"},ie={__name:"index",async setup(r){let t,s;const i=u([]),n=T(Y().public.minpress),w=F(),M=w.protocol+"//"+w.host;console.log(n),console.log(M),console.log("mode===>"+n.mode);const a=u(1),c=u(!1),m=u(!1);H(()=>{{window.addEventListener("scroll",y);let e=document.body.scrollHeight,o=window.scrollY+window.innerHeight;console.log("d:"+e+", s:"+o),e<o&&S()}}),k(()=>{window.removeEventListener("scroll",y)});const d=u(!1);function S(){if(!c.value&&!m.value){c.value=!0;try{console.log("pageNo=="+a.value);const e=n.mode==v.FCM?"/api/md/query":n.mode==v.SCM?n.metaUrl:null;V({pageNo:a.value,url:e}).then(o=>{c.value=!1,a.value>=o.totalPage?m.value=!0:a.value=a.value+1,i.value.push(...o.data)},o=>{c.value=!1,console.error(o)})}catch(e){console.warn(e),c.value=!1}}m.value&&(d.value=!1)}function y(e){{var o=window.scrollY;o<this.scrollPosition?console.log("Scrolling up"):console.log("Scrolling down");let l=document.body.scrollHeight;window.scrollY+window.innerHeight+200>l?(console.log("You are at the bottom! isLoading="+c.value+", is isLastPage="+m.value),d.value=!0,S()):d.value=!1,this.scrollPosition=window.scrollY}}if(n.mode===v.SSG){if(i.value.length<=0){const{data:e}=([t,s]=g(()=>A("home",()=>O().sort({_id:1}).find())),t=await t,s(),t);console.log("--------data SSG-----");const o=e.value.map(l=>h(l));i.value=o}}else if(n.mode===v.FCM)try{const{data:e}=([t,s]=g(()=>C("/api/md/query",{method:"POST",body:{pageNo:a.value,pageSize:9,sort:{createTime:-1,title:1}}},"$PslAyef5YX")),t=await t,s(),t);a.value=a.value+1;const o=e.value.data.map(l=>h(l));i.value=o}catch(e){console.warn(e)}else{const{data:e}=([t,s]=g(()=>C(n.metaUrl,"$6PO73qLRkI")),t=await t,s(),t);if(a.value=a.value+1,e.value.totalElements>0){const o=u([]);o.value=e.value.content.map(l=>U(l)),i.value=o.value}}return(e,o)=>{const l=R,L=x,N=E;return f(),p("div",null,[_(l),b("main",$,[b("div",I,[(f(!0),p(q,null,z(i.value,P=>(f(),p("div",{class:"article",key:P.id},[_(L,{item:P},null,8,["item"])]))),128))]),d.value?(f(),p("a",G,[B("Loading "),_(N,{name:"i-heroicons-ellipsis-horizontal-16-solid"})])):D("",!0)])])}}};export{ie as default};
