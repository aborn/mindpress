import R from"./BbhujEJT.js";import{l as T,g as A,r as c,h as D,i,O as d,o as f,s as q,P as E,f as r,w as _,b as m,k as $,c as G}from"./BQrurp_X.js";import{b as H,m as M}from"./tRb40OuR.js";import{M as p}from"./DshPJGOp.js";import{q as O}from"./D-cZRY_v.js";import{u as N}from"./Bo7LX_eA.js";import{u as K}from"./DzzCe9w1.js";import"./tzvpYkiG.js";import"./C-v3KzvZ.js";import"./s7MsaHrm.js";import"./DvDH6DOc.js";const V={key:1},oe=T({__name:"[...slug]",async setup(I){let t,n;const g=A(),e=c(),y=c(""),h=c(""),s=H(D().public.minpress),k=g.query,C=g.params.slug,l=(s.mode===p.SSG||s.mode===p.FCM)&&C[0]==="undefined"?c(null):c(C[0]);if(!l.value&&k.id&&(l.value=k.id),console.log("mode===>"+s.mode),s.mode===p.SSG){y.value="No content found.";const a="/article/"+l.value;console.log(a);const o=l.value.indexOf(":")>=0?([t,n]=i(()=>O().where({_id:{$eq:l.value}}).findOne()),t=await t,n(),t):([t,n]=i(()=>O().where({permalink:{$eq:a}}).findOne()),t=await t,n(),t);console.log(o),e.value=o,e.value.time=o.date,e.value.author=M(o),e.value.articleid=l.value,h.value=o.body.toc}else if(s.mode==p.FCM)try{const{data:a}=([t,n]=i(()=>N("/api/md/query?_id="+l.value,"$0BnwCKfSa4")),t=await t,n(),t);console.log("***************");const o=a.value;console.log(o),e.value=o,e.value.time=o.date,e.value.author=M(o),e.value.articleid=l.value,h.value=o.body.toc}catch(a){console.warn(a)}else{console.log("server mode.");const a=s.contentUrl+"/"+l.value,{data:o}=([t,n]=i(()=>N(a,"$lwINgKkBK1")),t=await t,n(),t),v=c(o.value.content),{data:u,refresh:w}=([t,n]=i(async()=>K(l.value,async()=>{try{return await $fetch("/api/parse",{method:"POST",cors:!0,body:{id:"content:_file.md",content:v.value}})}catch{return u.value}},"$H6Gdzox8c9")),t=await t,n(),t);u.value.success||(y.value='Markdown parser error: <span style="color:red">'+u.value.msg+"</span>. Program language does not support."),e.value=u.value.data,e.value.title=o.value.title,e.value.author=o.value.createBy,e.value.time=o.value.createTime,e.value.articleid=o.value.articleid,e.value.editable=o.value.editable}return(a,o)=>{var S,U,P;const v=d("UPageHeader"),u=R,w=d("UContentSurround"),b=d("UPageBody"),x=d("UContentToc"),F=d("UPage");return f(),q(F,null,E({default:_(()=>[m(v,{title:r(e).title,description:r(e).description,links:r(e).links},null,8,["title","description","links"]),m(b,{prose:""},{default:_(()=>{var B;return[r(e).body?(f(),q(u,{key:0,value:r(e)},null,8,["value"])):$("",!0),(B=a.surround)!=null&&B.length?(f(),G("hr",V)):$("",!0),m(w,{surround:a.surround},null,8,["surround"])]}),_:1})]),_:2},[(P=(U=(S=r(e).body)==null?void 0:S.toc)==null?void 0:U.links)!=null&&P.length?{name:"right",fn:_(()=>[m(x,{links:r(e).body.toc.links},null,8,["links"])]),key:"0"}:void 0]),1024)}}});export{oe as default};
