import{_ as M}from"./C2QMvkF5.js";import{_ as b}from"./CTd0D3PB.js";import{b as P,_ as R}from"./DwTJUGzn.js";import{b as x,c as q,d as E}from"./CvIXsaFB.js";import{q as c,D as U,s as Y,Y as H,E as f,c as d,b as _,a as C,F as k,A as B,d as D,z as F,o as p}from"./CRC3xU_A.js";import{u as T}from"./BdXfjVkr.js";import{M as v}from"./DshPJGOp.js";import{q as A}from"./D6hdfF8E.js";import{u as V}from"./CfXWV_d_.js";import{q as z}from"./Dkr9wi64.js";import"./CBblR6-z.js";import"./CmC9KqP7.js";import"./BBboxA-V.js";import"./CAZilBRX.js";import"./DvDH6DOc.js";import"./C6ihqJsh.js";const I={class:"container"},O={class:"articles"},$={key:0,href:"#"},ce={__name:"index",async setup(G){let t,n;const r=c([]),s=x(U().public.minpress),g=T(),N=g.protocol+"//"+g.host;console.log(s),console.log(N),console.log("mode===>"+s.mode);const a=c(1),i=c(!1),u=c(!1);Y(()=>{{window.addEventListener("scroll",w);let e=document.body.scrollHeight,o=window.scrollY+window.innerHeight;console.log("d:"+e+", s:"+o),e<o&&h()}}),H(()=>{window.removeEventListener("scroll",w)});const m=c(!1);function h(){if(!i.value&&!u.value){i.value=!0;try{console.log("pageNo=="+a.value);const e=s.mode==v.FCM?"/api/md/query":s.mode==v.SCM?s.metaUrl:null;A({pageNo:a.value,url:e}).then(o=>{i.value=!1,a.value>=o.totalPage?u.value=!0:a.value=a.value+1,r.value.push(...o.data)},o=>{i.value=!1,console.error(o)})}catch(e){console.warn(e),i.value=!1}}u.value&&(m.value=!1)}function w(e){{var o=window.scrollY;o<this.scrollPosition?console.log("Scrolling up"):console.log("Scrolling down");let l=document.body.scrollHeight;window.scrollY+window.innerHeight+200>l?(console.log("You are at the bottom! isLoading="+i.value+", is isLastPage="+u.value),m.value=!0,h()):m.value=!1,this.scrollPosition=window.scrollY}}if(s.mode===v.SSG){if(r.value.length<=0){const{data:e}=([t,n]=f(()=>V("home",()=>z().sort({_id:1}).find())),t=await t,n(),t);console.log("--------data SSG-----");const o=e.value.map(l=>q(l));r.value=o}}else if(s.mode===v.FCM)try{const{data:e}=([t,n]=f(()=>P("/api/md/query",{method:"POST",body:{pageNo:a.value,pageSize:9,sort:{createTime:-1,title:1}}},"$PslAyef5YX")),t=await t,n(),t);a.value=a.value+1;const o=e.value.data.map(l=>q(l));r.value=o}catch(e){console.warn(e)}else{const{data:e}=([t,n]=f(()=>P(s.metaUrl,"$6PO73qLRkI")),t=await t,n(),t);if(a.value=a.value+1,e.value.totalElements>0){const o=c([]);o.value=e.value.content.map(l=>E(l)),r.value=o.value}}return(e,o)=>{const l=M,S=b,y=R;return p(),d("div",null,[_(l),C("main",I,[C("div",O,[(p(!0),d(k,null,B(r.value,L=>(p(),d("div",{class:"article",key:L.id},[_(S,{item:L},null,8,["item"])]))),128))]),m.value?(p(),d("a",$,[D("Loading "),_(y,{name:"i-heroicons-ellipsis-horizontal-16-solid"})])):F("",!0)])])}}};export{ce as default};
