import{_ as R}from"./-21WTBdm.js";import{_ as x}from"./lItZn4dC.js";import{b as N,_ as E}from"./NbySAA8G.js";import{c as _,b as M,d as T}from"./Cg1U94MN.js";import{q as i,D as Y,s as H,Y as U,E as f,c as d,b as v,a as b,F as k,A as B,d as D,z,o as p}from"./DVzZLM5D.js";import{u as A}from"./BAXOU--h.js";import{M as q}from"./DshPJGOp.js";import{u as F}from"./B6rEZBAn.js";import{q as O}from"./BBSKn4rz.js";import"./CiDryU3a.js";import"./DIr6hZ2v.js";import"./DxBEmFh8.js";import"./CAZilBRX.js";import"./DvDH6DOc.js";import"./DFUzX_zX.js";async function V(g,o="fcm"){const a=await $fetch("/api/md/query",{method:"POST",body:{pageNo:g,pageSize:9,sort:{createTime:-1,title:1}}});return a.data=a.data.map(n=>_(n)),a}const $={class:"container"},I={class:"articles"},G={key:0,href:"#"},ie={__name:"index",async setup(g){let o,a;const n=i([]),c=M(Y().public.minpress),h=A(),C=h.protocol+"//"+h.host;console.log(c),console.log(C),console.log("mode===>"+c.mode);const l=i(1),r=i(!1),u=i(!1);H(()=>{{window.addEventListener("scroll",S);let e=document.body.scrollHeight,t=window.scrollY+window.innerHeight;console.log("d:"+e+", s:"+t),e<t&&w()}}),U(()=>{window.removeEventListener("scroll",S)});const m=i(!1);function w(){if(!r.value&&!u.value){r.value=!0;try{console.log("pageNo=="+l.value),V(l.value).then(e=>{r.value=!1,l.value>=e.totalPage?u.value=!0:l.value=l.value+1,n.value.push(...e.data)},e=>{r.value=!1,console.error(e)})}catch(e){console.warn(e),r.value=!1}}u.value&&(m.value=!1)}function S(e){{var t=window.scrollY;t<this.scrollPosition?console.log("Scrolling up"):console.log("Scrolling down");let s=document.body.scrollHeight;window.scrollY+window.innerHeight+200>s?(console.log("You are at the bottom! isLoading="+r.value+", is isLastPage="+u.value),m.value=!0,w()):m.value=!1,this.scrollPosition=window.scrollY}}if(c.mode===q.SSG){if(n.value.length<=0){const{data:e}=([o,a]=f(()=>F("home",()=>O().sort({_id:1}).find())),o=await o,a(),o);console.log("--------data SSG-----");const t=e.value.map(s=>_(s));n.value=t}}else if(c.mode===q.FCM)try{const{data:e}=([o,a]=f(()=>N("/api/md/query",{method:"POST",body:{pageNo:l.value,pageSize:9,sort:{createTime:-1,title:1}}},"$PslAyef5YX")),o=await o,a(),o);l.value=l.value+1,console.log(e.value.data);const t=e.value.data.map(s=>_(s));n.value=t}catch(e){console.warn(e)}else{const{data:e}=([o,a]=f(()=>N(c.metaUrl,"$6PO73qLRkI")),o=await o,a(),o);if(e.value.totalElements>0){const t=i([]);t.value=e.value.content.map(s=>T(s)),n.value=t.value}}return(e,t)=>{const s=R,y=x,L=E;return p(),d("div",null,[v(s),b("main",$,[b("div",I,[(p(!0),d(k,null,B(n.value,P=>(p(),d("div",{class:"article",key:P.id},[v(y,{item:P},null,8,["item"])]))),128))]),m.value?(p(),d("a",G,[D("Loading "),v(L,{name:"i-heroicons-ellipsis-horizontal-16-solid"})])):z("",!0)])])}}};export{ie as default};
