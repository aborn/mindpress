import{y,z as m,A as d,_ as g}from"./entry.93c0adaa.js";import{h as _}from"./index.9bb628c0.js";import{w as $,s as E,u as A}from"./utils.9b8f4557.js";const p=(t,r)=>r.split(".").reduce((e,s)=>e&&e[s],t),l=(t,r)=>Object.keys(t).filter(r).reduce((e,s)=>Object.assign(e,{[s]:t[s]}),{}),P=t=>r=>Array.isArray(r)?r.map(e=>t(e)):t(r),w=t=>{const r=[],e=[];for(const s of t)["$","_"].includes(s)?r.push(s):e.push(s);return{prefixes:r,properties:e}},R=(t=[])=>r=>{if(t.length===0||!r)return r;const{prefixes:e,properties:s}=w(t);return l(r,n=>!s.includes(n)&&!e.includes(n[0]))},D=(t=[])=>r=>{if(t.length===0||!r)return r;const{prefixes:e,properties:s}=w(t);return l(r,n=>s.includes(n)||e.includes(n[0]))},I=(t,r)=>{const e=new Intl.Collator(r.$locale,{numeric:r.$numeric,caseFirst:r.$caseFirst,sensitivity:r.$sensitivity}),s=Object.keys(r).filter(n=>!n.startsWith("$"));for(const n of s)t=t.sort((i,a)=>{const o=[p(i,n),p(a,n)].map(u=>{if(u!==null)return u instanceof Date?u.toISOString():u});return r[n]===-1&&o.reverse(),e.compare(o[0],o[1])});return t},L=(t,r="Expected an array")=>{if(!Array.isArray(t))throw new TypeError(r)},c=t=>Array.isArray(t)?t:t?[t]:[],S=["sort","where","only","without"],f=(t,r)=>{const e={...r};for(const i of S)e[i]&&(e[i]=c(e[i]));const s=(i,a=o=>o)=>(...o)=>(e[i]=a(...o),n),n={params:()=>e,only:s("only",c),without:s("without",c),where:s("where",i=>[...c(e.where),i]),sort:s("sort",i=>[...c(e.sort),...c(i)]),limit:s("limit",i=>parseInt(String(i),10)),skip:s("skip",i=>parseInt(String(i),10)),find:()=>t(n),findOne:()=>(e.first=!0,t(n)),findSurround:(i,a)=>(e.surround={query:i,...a},t(n)),locale:i=>n.where({_locale:i})};return n};function k(t){return JSON.stringify(t,x)}function x(t,r){return r instanceof RegExp?`--REGEX ${r.toString()}`:r}const h=t=>async r=>{var i;t&&(r.params().first&&(r.params().where||[]).length===0?r.where({_path:d(t)}):r.where({_path:new RegExp(`^${t.replace(/[-[\]{}()*+.,^$\s/]/g,"\\$&")}`)})),(i=r.params().sort)!=null&&i.length||r.sort({_file:1,$numeric:!0});const e=r.params(),s=$(`/query/${_(e)}.json`);if(E())return(await g(()=>import("./client-db.56cf0275.js"),["./client-db.56cf0275.js","./entry.93c0adaa.js","./utils.9b8f4557.js","./_commonjsHelpers.fed2a411.js","./index.9bb628c0.js"],import.meta.url).then(o=>o.useContentDatabase())).fetch(r);const n=await $fetch(s,{method:"GET",responseType:"json",params:{_params:k(e),previewToken:A("previewToken").value}});if(typeof n=="string"&&n.startsWith("<!DOCTYPE html>"))throw new Error("Not found");return n};function b(t,...r){return typeof t=="string"?f(h(y(m(t,...r)))):f(h(),t)}export{L as a,P as b,D as c,f as d,c as e,p as g,k as j,b as q,I as s,R as w};
